// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Faculty {
  id   String @id @unique @default(uuid())
  name String
}

model User {
  id       String  @id
  name     String
  year     Int
  faculty  String
  nusnetId String
  gmail    String
  telegram String?

  tutor   Tutor?
  student Student?
}

model Student {
  userId String @id @unique
  user   User   @relation(fields: [userId], references: [id])

  // A student can have many assignments
  assignments Assignment[]

  // A student learns many modules
  modules Module[]
}

model Tutor {
  user   User   @relation(fields: [userId], references: [id])
  userId String @id @unique

  // A tutor can have many assignments
  assignments Assignment[]

  // A tutor teaches many modules
  modules Module[]
}

model Module {
  code  String @id
  title String

  // Tutors who teach this module
  tutors Tutor[]

  // Students who learn the module
  students Student[]

  assignments Assignment[]
}

model Assignment {
  id String @id @default(uuid())

  // Each Assignment linked to one tutor
  tutor   Tutor  @relation(fields: [tutorId], references: [userId])
  tutorId String

  // Each Assignment linked to one student
  student   Student @relation(fields: [studentId], references: [userId])
  studentId String

  // Each assignment is linked to one module
  module     Module @relation(fields: [moduleCode], references: [code])
  moduleCode String

  timeslots Timeslot[]

  // Will be generated when an assignment is created why Google Meet API
  meetingURL String

  // These will be used to pull the files from firebase when required
  fileURLs String[]
}

model Timeslot {
  id String @id @default(uuid())

  // Find a way to validate start < end, and slot end - start = 30 minutes
  start DateTime
  end   DateTime

  Assignment   Assignment? @relation(fields: [assignmentId], references: [id])
  assignmentId String?

  selected Boolean @default(false)
}
